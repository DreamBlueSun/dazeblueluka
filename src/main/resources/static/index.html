<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="common/jquery/jquery-3.4.0.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="common/bootstrap/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="common/js/path.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
        var websocket = null;

        function abc() {
            // 初始化websocket
            var userName = document.getElementById("userName").value;
            //判断浏览器是否支持websocket
            if ('WebSocket' in window) {
                var url = "ws://" + document.location.host + pathHead + "webSocket/" + roomName + "/" + userName;
                web_socket = new WebSocket(url);
                websocket.onopen = function () {
                    setMessage("连接成功")
                }
                websocket.onclose = function () {
                    setMessage("连接关闭")
                }
                websocket.onerro = function () {
                    setMessage("连接出错")
                }
                websocket.onmessage = function (message) {
                    setMessage(message.data)
                }

            } else {
                alert("....")
            }
        }


        function setMessage(data) {
            var xianshi = document.getElementById("xianshi");
            xianshi.innerHTML = data;
        }


        function close() {
            if (websocket != null) {
                websocket.close()
            }
        }

        //发送消息
        function sendmessage() {
            //接收者
            var to = document.getElementById("to").value;
            //获取要发送的内容
            var msg = document.getElementById("content").value;
            if (websocket != null) {
                var message = '{"to":"' + to + '","content":"' + msg + '"}';
                websocket.send(message)
            }

        }


        //页面关闭之前
        window.onbeforeunload = function () {
            close();
        }


    </script>
</head>
<body>


用户名: <input id="userName">
<button onclick="abc()">连接</button>
<br>
接收者:<input id="to"><br>

内容:<input id="content">
<button onclick="sendmessage()">发送</button>
<br>

<br>
<br>
<br>
<br>
<br>
<br>
<span id="xianshi"></span>

</body>
</html>